<h1>Python Advanced</h1>
<h2>Slides</h2>
<p><a href="https://marko-knoebl.github.io/slides/">https://marko-knoebl.github.io/slides/</a></p>
<h2>Your Trainer</h2>
<p>Marko Knöbl</p>
<ul>
<li>Frontend Web-Development<ul>
<li>JavaScript</li>
<li>React, Angular</li>
</ul></li>
<li>Programming<ul>
<li>Python, JavaScript</li>
</ul></li>
</ul>
<h2>Introduction of Participants</h2>
<ul>
<li>current projects</li>
<li>prior knowledge</li>
<li>expectations</li>
</ul>
<h2>Organizational</h2>
<ul>
<li>duration</li>
<li>breaks</li>
<li>lunch</li>
<li>materials</li>
<li>questions, feedback?</li>
</ul>
<h2>Code</h2>
<p>Code available at: <a href="https://github.com/marko-knoebl/courses-code">https://github.com/marko-knoebl/courses-code</a></p>
<h1>Topics</h1>
<h2>Topics</h2>
<ul>
<li>logging</li>
<li>unit tests</li>
<li>type annotations</li>
<li>advanced object-oriented programming<ul>
<li>properties</li>
<li>static attributes and methods</li>
<li>magic methods</li>
<li>inheritance</li>
</ul></li>
<li>iterators</li>
<li>functions: advanced<ul>
<li>lambdas</li>
<li>decorators</li>
<li>functools</li>
<li>memoization</li>
</ul></li>
<li>advanced data types: set, namedtuple, enum</li>
<li>parallelization: threads and multiprocessing</li>
</ul>
<h1>Logging</h1>
<h2>Logging</h2>
<p>long-running programs can document what they are doing in files</p>
<p>e.g.: long-running algorithms, web servers</p>
<h2>Logging</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> logging
logging.basicConfig(
    filename=<span class="hljs-string">"sort.log"</span>,
    level=logging.DEBUG,
    filemode=<span class="hljs-string">"w"</span>
)

logging.debug(<span class="hljs-string">"hello"</span>)
</code></pre>
<h2>Logging</h2>
<p>Example: sorting algorithm</p>
<h1>Unit tests</h1>
<h2>assert</h2>
<h2>Doctests</h2>
<p>Code examples and unit tests in one - inside the doc string</p>
<h2>Doctests</h2>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(a, b)</span>:</span>
    <span class="hljs-string">"""Add two numbers.

    >>> add(2, 3)
    5
    """</span>
</code></pre>
<h2>Running doctests</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">import</span> doctest
    doctest.testmod()
</code></pre>
<h2>Doctests: long outputs</h2>
<pre><code class="hljs language-py"><span class="hljs-string">"""
<span class="hljs-meta">>>> </span>bubblesort(list(range(10))) #doctest: +NORMALIZE_WHITESPACE
[0, 1, 2, 3, 4, 5,
6, 7, 8, 9]
<span class="hljs-meta">>>> </span>bubblesort(list(range(10))) #doctest: +ELLIPSIS
[0, 1, 2, ..., 8, 9]
"""</span>
</code></pre>
<h2>Unit tests</h2>
<p>Possibilities:</p>
<ul>
<li>unittest (standard library)</li>
<li>pytest</li>
<li>nose</li>
</ul>
<h2>unittest</h2>
<p>test_tictactoe.py</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> tictactoe <span class="hljs-keyword">import</span> has_won

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HasWon</span><span class="hljs-params">(unittest.TestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_has_won_first_row_x</span><span class="hljs-params">(self)</span>:</span>
        board = [[<span class="hljs-string">"X"</span>, <span class="hljs-string">"X"</span>, <span class="hljs-string">"X"</span>],
                 [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>],
                 [<span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>]]
        w = has_won(board, <span class="hljs-string">"X"</span>)
        self.assertTrue(w)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    unittest.main()
</code></pre>
<h2>unittest</h2>
<p>Running all tests in files that end in <em>test*.py</em>:</p>
<pre><code class="hljs language-bash">python -m unittest
</code></pre>
<p>Search for a different pattern:</p>
<pre><code class="hljs language-bash">python -m unittest discover -p <span class="hljs-string">"*_test.py"</span>
</code></pre>
<p>Note: in order to be discovered all packages must contain a file named <em>__init__.py</em> (siehe <a href="https://bugs.python.org/issue35617">https://bugs.python.org/issue35617</a>)</p>
<h2>unittest - Assertions</h2>
<p>assertions:</p>
<ul>
<li><code>.assertEqual(a, 3)</code></li>
<li><code>.assertTrue(b)</code></li>
<li><code>.assertFalse(c)</code></li>
<li><code>.assertIsNone(d)</code></li>
<li><code>.assertIn(a, [2, 3, 4])</code></li>
<li><code>.assertIsInstance(a, int)</code></li>
<li><code>.assertRaises(TypeError, len)</code></li>
<li>...</li>
</ul>
<p>there are also contrary assertions, e.g. <code>.assertNotEqual(a, 3)</code></p>
<h2>unittest - setUp and tearDown</h2>
<p>Defining functions that are executed before / after each test:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">import</span> unittest

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WidgetTestCase</span><span class="hljs-params">(unittest.TestCase)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">setUp</span><span class="hljs-params">(self)</span>:</span>
        self.widget = Widget(<span class="hljs-string">'The widget'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tearDown</span><span class="hljs-params">(self)</span>:</span>
        self.widget.dispose()
</code></pre>
<h2>unittest - test coverage</h2>
<p>PIP package <em>coverage</em></p>
<p>execution:</p>
<pre><code class="hljs language-bash">coverage run test_shorten.py
coverage report
</code></pre>
<p>Example output:</p>
<pre><code class="hljs language-asciidoc"><span class="hljs-section">Name              Stmts   Miss  Cover
-------------------------------------</span>
shorten.py            4      0   100%
<span class="hljs-section">test_shorten.py      11      0   100%
-------------------------------------</span>
TOTAL                15      0   100%
</code></pre>
<h1>Docstrings</h1>
<h2>Displaying docstrings</h2>
<p>from the interactive Python console:</p>
<pre><code class="hljs language-py">help(round)
<span class="hljs-keyword">import</span> math
help(math)
help(math.floor)
</code></pre>
<p>from the terminal:</p>
<pre><code class="hljs language-bash">python -m pydoc round
python -m pydoc math
python -m pydoc math.floor
</code></pre>
<h2>Docstring format</h2>
<p>PEP 257: <a href="https://www.python.org/dev/peps/pep-0257/">https://www.python.org/dev/peps/pep-0257/</a></p>
<h2>Docstrig format</h2>
<p>Docstring of a module: description, list of exported Functions with single-line summaries</p>
<p>Docstring of a class: description, list of methods</p>
<p>Docstring of a function: description, list of parameters</p>
<h2>Pydocstyle</h2>
<p>Linter for validating docstrings</p>
<h2>reStructuredText and Sphinx</h2>
<p><em>reStructuredText (reST)</em> = simple markup language (similar to <em>Markdown</em>), is used in Python docstrings</p>
<p><em>Sphinx</em> = tool that uses existing docstrings to generate documentation in HTML and similar formats</p>
<h2>reStructuredText</h2>
<p>Example:</p>
<pre><code class="hljs language-rest">Heading
=======

- list item 1
- list item 2

Link to `Wikipedia`_.

.. _Wikipedia: https://www.wikipedia.org/

.. code:: python

   print("hello")
</code></pre>
<h1>Type hints</h1>
<h2>Type hints</h2>
<p>Newer Python versions support optional type hints</p>
<p>Type hints can support the IDE - e.g. by providing additional errors</p>
<h2>Type checkers</h2>
<ul>
<li>mypy</li>
<li>pyright</li>
</ul>
<p>VS Code extensions are available</p>
<h2>Type hints</h2>
<p>Variables:</p>
<pre><code class="hljs language-py">i: int = <span class="hljs-number">3</span>
</code></pre>
<h2>Functions</h2>
<p>Functions:</p>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">double</span><span class="hljs-params">(n: int)</span> -> int:</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * n
</code></pre>
<h2>Collections</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> List, Set, Dict, Tuple

names: List[int] = [<span class="hljs-string">'Anna'</span>, <span class="hljs-string">'Bernd'</span>, <span class="hljs-string">'Caro'</span>]
anna: Tuple[str, str, int] = (<span class="hljs-string">'Anna'</span>, <span class="hljs-string">'Berger'</span>, <span class="hljs-number">1990</span>)
roman: Dict[int, str] = {<span class="hljs-number">1</span>: <span class="hljs-string">'I'</span>, <span class="hljs-number">2</span>: <span class="hljs-string">'II'</span>, <span class="hljs-number">3</span>: <span class="hljs-string">'III'</span>, <span class="hljs-number">4</span>: <span class="hljs-string">'IV'</span>}
</code></pre>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Iterable

names: Iterable[str] = ...
</code></pre>
<h1>Advanced object-oriented programming</h1>
<h2>Advanced object-oriented programming</h2>
<p>Example: class <em>Length</em></p>
<pre><code class="hljs language-py">a = Length(<span class="hljs-number">130</span>, <span class="hljs-string">"cm"</span>)
a.value <span class="hljs-comment"># 130</span>
a.unit <span class="hljs-comment"># cm</span>
a.unit = <span class="hljs-string">"in"</span>
a.value <span class="hljs-comment"># 51.18</span>
str(a) <span class="hljs-comment"># 51.18in</span>
b = Length.from_string(<span class="hljs-string">"12cm"</span>)
<span class="hljs-number">2</span> * b <span class="hljs-comment"># 24cm</span>
b + a <span class="hljs-comment"># 142cm</span>
</code></pre>
<h1>OOP: Properties</h1>
<h2>Properties</h2>
<p>Getters &#x26; setters (not common in Python):</p>
<pre><code class="hljs language-py">r = Rectangle(length=<span class="hljs-number">3</span>, width=<span class="hljs-number">4</span>)
print(r.get_area()) <span class="hljs-comment"># 12</span>
r.set_length(<span class="hljs-number">4</span>)
print(r.get_area()) <span class="hljs-comment"># 16</span>
</code></pre>
<p>Using properties in Python:</p>
<pre><code class="hljs language-py">r = Rectangle(length=<span class="hljs-number">3</span>, width=<span class="hljs-number">4</span>)
print(r.area) <span class="hljs-comment"># 12</span>
r.length = <span class="hljs-number">4</span>
print(r.area) <span class="hljs-comment"># 16</span>
</code></pre>
<h2>Properties</h2>
<p>Exercise: Implement a class called <code>Rectangle_gs</code> that uses getters and setters</p>
<h2>Properties</h2>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle_gs</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, length, width)</span>:</span>
        self._length = length
        self._width = width

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_length</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self._length

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_length</span><span class="hljs-params">(self, new_length)</span>:</span>
        self._length = new_length

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_width</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self._width

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">set_width</span><span class="hljs-params">(self, new_width)</span>:</span>
        self._width = new_width

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_area</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self._length * self._width
</code></pre>
<h2>Properties</h2>
<p>With properties we can "redirect" reading and writing of attributes to a function - so accessing <code>r.area</code> can lead to the execution of a getter or setter function.</p>
<h2>Properties</h2>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, length, width)</span>:</span>
        self.length = length
        self.width = width

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_area</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.length * self.width
    
    area = property(_get_area)
</code></pre>
<p><code>property</code> is a built-in, so it's always available</p>
<h2>Properties</h2>
<p>Extension: Setter for <em>area</em></p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>:</span>
    ...

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_set_area</span><span class="hljs-params">(self, new_area)</span>:</span>
        <span class="hljs-comment"># adjust the length</span>
        self.length = new_area / self.width
    
    area = property(_get_area, _set_area)
</code></pre>
<h2>Properties</h2>
<p>Alternative way to create Properties via decorators:</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Rectangle</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, length, width)</span>:</span>
        self.length = length
        self.width = width

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">area</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.length * self.width
    
<span class="hljs-meta">    @area.setter</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">area</span><span class="hljs-params">(self, new_area)</span>:</span>
        self.length = new_area / self.width
</code></pre>
<h1>OOP: Static attributes and methods</h1>
<h2>Class attributes (static attributes)</h2>
<p><em>Class attributes</em> are attributes that are only defined on the class (not on each instance) - all instances share these attributes.</p>
<h2>Class attributes (static attributes)</h2>
<p>Example: <code>Money</code> class with a shared class attribute called <code>_currency_data</code></p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>:</span>
    _currency_data = [
        {<span class="hljs-string">"code"</span>: <span class="hljs-string">"USD"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"$"</span>, <span class="hljs-string">"rate"</span>: <span class="hljs-number">1.0</span>},
        {<span class="hljs-string">"code"</span>: <span class="hljs-string">"EUR"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"€"</span>, <span class="hljs-string">"rate"</span>: <span class="hljs-number">1.1</span>},
        {<span class="hljs-string">"code"</span>: <span class="hljs-string">"GBP"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"£"</span>, <span class="hljs-string">"rate"</span>: <span class="hljs-number">1.25</span>},
        {<span class="hljs-string">"code"</span>: <span class="hljs-string">"JPY"</span>, <span class="hljs-string">"symbol"</span>: <span class="hljs-string">"¥"</span>, <span class="hljs-string">"rate"</span>: <span class="hljs-number">0.01</span>},
    ]

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, ...)</span>:</span>
        ...
</code></pre>
<h2>Static methods</h2>
<p>If a method does not have to access data of a specific instance it can be declared as a static Method.</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>:</span>
    ...

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_currency_data</span><span class="hljs-params">(code)</span>:</span>
        <span class="hljs-keyword">for</span> currency <span class="hljs-keyword">in</span> Money._currency_data:
            <span class="hljs-keyword">if</span> code == currency[<span class="hljs-string">"code"</span>]:
                <span class="hljs-keyword">return</span> currency
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"unknown currency: <span class="hljs-subst">{code}</span>"</span>)
</code></pre>
<p>Note: A static method does not receive <code>self</code> as its first parameter - there is no reference to a specific instance.</p>
<h2>Static methods</h2>
<p>There are two main applications for static methods:</p>
<ul>
<li>Creation of instances: e.g. <code>Money.from_string("23.40EUR")</code></li>
<li>Bundling of helper functions into a class: e.g. <code>_get_currency_data</code></li>
</ul>
<h2>Class methods</h2>
<p>If we want to make the followng code more portable (especially for inheritance) it would make sense not to mention the class name (<code>Money</code>) in the method definition:</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>:</span>
    ...

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_currency_data</span><span class="hljs-params">(code)</span>:</span>
        <span class="hljs-keyword">for</span> currency <span class="hljs-keyword">in</span> Money._currency_data:
            <span class="hljs-keyword">if</span> code == currency[<span class="hljs-string">"code"</span>]:
                <span class="hljs-keyword">return</span> currency
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"unknown currency: <span class="hljs-subst">{code}</span>"</span>)
</code></pre>
<h2>Class methods</h2>
<p>Class methods are special static methods which enable referencing the class by a generic name (conventionally <code>cls</code>):</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span>:</span>
    ...

<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_currency_data</span><span class="hljs-params">(cls, code)</span>:</span>
        <span class="hljs-keyword">for</span> currency <span class="hljs-keyword">in</span> cls._currency_data:
            <span class="hljs-keyword">if</span> code == currency[<span class="hljs-string">"code"</span>]:
                <span class="hljs-keyword">return</span> currency
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"unknown currency: <span class="hljs-subst">{code}</span>"</span>)
</code></pre>
<h1>OOP: Magic Methods</h1>
<h2>Magic Methods</h2>
<p>Magic methods are special methods that influence the behavior of a class.</p>
<p>They begin and end with two underscores, e.g. <code>__init__</code></p>
<p>List of magic methods: <a href="https://docs.python.org/3/reference/datamodel.html#special-method-names">https://docs.python.org/3/reference/datamodel.html#special-method-names</a></p>
<h2>Magic Methods</h2>
<p>Methods for converting to strings:</p>
<ul>
<li><code>__repr__</code>: default representation, ideally readable / interpretable by Python</li>
<li><code>__str__</code>: "nice" representation for humans, falls back to <code>__repr__</code> if not overwritten</li>
</ul>
<p>Example:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> time
a = time(<span class="hljs-number">23</span>, <span class="hljs-number">45</span>)
repr(a) <span class="hljs-comment"># 'datetime.time(23, 45)'</span>
str(a) <span class="hljs-comment"># '23:45:00'</span>
</code></pre>
<h2>Magic Methods</h2>
<p>Methods for mathematical operators:</p>
<ul>
<li><code>__add__</code></li>
<li><code>__mul__</code></li>
<li><code>__rmul__</code></li>
<li>...</li>
</ul>
<h2>Magic Methods</h2>
<ul>
<li><code>__call__</code></li>
<li><code>__getitem__</code></li>
</ul>
<h1>OOP: Inheritance</h1>
<h2>Subclasses and order of inheritance</h2>
<h2>super()</h2>
<p>Proxy for parent classes</p>
<h2>super()</h2>
<p>without super:</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span><span class="hljs-params">(A, B)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, x, y)</span>:</span>
        A.__init__(self, x, y)
        B.__init__(self, x, y)
</code></pre>
<h2>super()</h2>
<p>with super:</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span><span class="hljs-params">(A, B)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, x, y)</span>:</span>
        super().__init__(x, y)
</code></pre>
<h1>OOP: In depth</h1>
<h2>Class decoration</h2>
<pre><code class="hljs language-py"><span class="hljs-meta">@logattraccess</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Foo</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.a = <span class="hljs-number">3</span>

f = Foo()

f.a <span class="hljs-comment"># prints: "get property 'a'"</span>
f.b = <span class="hljs-number">3</span> <span class="hljs-comment"># prints: "set propery 'b'"</span>
</code></pre>
<h2>Instance attributes and slots</h2>
<p>In general we can assign any attributes</p>
<pre><code class="hljs language-py">a.value = <span class="hljs-number">3</span>
</code></pre>
<p>In order to reduce memory consumption we can define so-called <em>slots</em> in a class:</p>
<pre><code class="hljs language-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Money</span><span class="hljs-params">()</span>:</span>
    __slots__ = [<span class="hljs-string">'currency'</span>, <span class="hljs-string">'amount'</span>]
</code></pre>
<h2>Exercises</h2>
<ul>
<li>class "Vector"</li>
<li>class "BankAccount"</li>
<li>class "Dictionary" (thesaurus)</li>
</ul>
<h1>Iterators</h1>
<h2>Iterables and iterators</h2>
<p><em>iterable</em>: an object that can be iterated over via <code>for element in my_iterable</code></p>
<p><em>iterator</em>: an lightweight iterable</p>
<h2>Iterables and iterators</h2>
<p>examples of iterables:</p>
<ul>
<li>lists</li>
<li>dicts</li>
<li>range objects</li>
<li>iterators</li>
</ul>
<h2>Iterators</h2>
<p>An <em>iterator</em> is a lightweight iterable</p>
<p>possible advantages of iterators over lists:</p>
<ul>
<li>only create / access resources on demand</li>
<li>keep memory consumption low (only one generated object is ever in memory)</li>
</ul>
<h2>Iterators</h2>
<p>example: <code>open()</code> returns an iterator of lines in a file</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">with</span> open(<span class="hljs-string">"./wikipedia_complete.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:
        <span class="hljs-keyword">print</span> line
</code></pre>
<p>The file could be gigabytes in size and this would still work</p>
<h2>Iterators</h2>
<p>example functions:</p>
<p>Loads all files in <em>foo/</em> at the same time, then iterates over them:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> read_textfiles_as_list(<span class="hljs-string">"./foo/"</span>):
    print(text[:<span class="hljs-number">5</span>])
</code></pre>
<p>Loads and prints text files individually - keeping memory consumption low:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> text <span class="hljs-keyword">in</span> read_textfiles_as_iterator(<span class="hljs-string">"./foo/"</span>):
    print(text[:<span class="hljs-number">5</span>])
</code></pre>
<h2>Iterators</h2>
<p>calls that return iterators:</p>
<ul>
<li><code>enumerate()</code></li>
<li><code>reversed()</code></li>
<li><code>open()</code></li>
<li><code>os.walk()</code></li>
<li><code>os.scandir()</code></li>
<li><code>map()</code></li>
<li><code>filter()</code></li>
<li>functions in <a href="https://docs.python.org/3/library/itertools.html">itertools</a></li>
<li>most database cursors (PEP 249)</li>
<li>...</li>
</ul>
<p>note: <code>range</code> does not return an iterator (but a similar object)</p>
<h2>Itertools</h2>
<p><a href="https://docs.python.org/3/library/itertools.html">itertools</a>: module for creating iterators</p>
<ul>
<li><code>itertools.count</code></li>
<li><code>itertools.repeat</code></li>
<li><code>itertools.product</code></li>
<li>...</li>
</ul>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> count

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> count():
    print(i)
    <span class="hljs-keyword">if</span> i >= <span class="hljs-number">5</span>:
        <span class="hljs-keyword">break</span>

<span class="hljs-comment"># 0 1 2 3 4 5</span>
</code></pre>
<h1>Generator functions and generator expressions</h1>
<h2>Generator functions and generator expressions</h2>
<p><em>Generator functions</em> and <em>generator expressions</em> are two ways to define custom iterators</p>
<h2>Generator functions</h2>
<p>A function can contain a <code>yield</code> statement instead of a <code>return</code> statement - this makes it a generator</p>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">count</span><span class="hljs-params">()</span>:</span>
    i = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">yield</span> i
        i += i
</code></pre>
<p>A generator function can be repeatedly exited (via <code>yield</code>) and entered again (by requesting the next value)</p>
<h2>Exercise: reading text files in a folder</h2>
<p>create an iterator that returns the string contents of all UTF-8 text files in a directory</p>
<p>usage:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> content <span class="hljs-keyword">in</span> read_textfiles(<span class="hljs-string">"."</span>):
    print(content[:<span class="hljs-number">10</span>])
</code></pre>
<h2>Exercise: reading text files in a folder</h2>
<p>solution:</p>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_textfiles</span><span class="hljs-params">(path=<span class="hljs-string">"."</span>)</span>:</span>
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(path):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> open(path + <span class="hljs-string">"/"</span> + file) <span class="hljs-keyword">as</span> fobj:
                <span class="hljs-keyword">yield</span> fobj.read()
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
</code></pre>
<h2>Generator expressions</h2>
<p>Generator <em>expressions</em> are similar to list comprehensions</p>
<p>list comprehension:</p>
<pre><code class="hljs language-py">mylist = [i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>)]
</code></pre>
<p>generator expression:</p>
<pre><code class="hljs language-py">mygenerator = (i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>))
</code></pre>
<h2>Generator expressions</h2>
<p>summing all numbers from 1 to 10 million:</p>
<p>via a list comprehension - will use hundreds of megabytes in memory (see task manager):</p>
<pre><code class="hljs language-py">sum([a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>_000_001)])
</code></pre>
<p>via a generator expression:</p>
<pre><code class="hljs language-py">sum((a <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>_000_001)))
</code></pre>
<h1>Iterators: internals</h1>
<h2>Iterators: internals</h2>
<p>In Python every for loop happens via an <em>iterator</em>.</p>
<p>When iterating over an <em>iterable</em>, an <em>iterator</em> is created for that iteration.</p>
<p>Every iterable has an <code>__iter__</code> method which returns an iterator</p>
<h2>Iterators: internals</h2>
<p>An iterator has a method called <code>__next__</code></p>
<p><code>__next__()</code> either returns the next value of the iteration or raises a <code>StopIteration</code> exception</p>
<p>An iterator is actually <em>also</em> an iterable (it has an <code>__iter__</code> method which returns itself)</p>
<h2>Iterators: internals</h2>
<p>Iterator of a list:</p>
<pre><code class="hljs language-py">numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]

numbers_iterator = numbers.__iter__()
</code></pre>
<h2>Iterators: internals</h2>
<p>Iterators have a method named <code>__next__</code> which will return the next object of an iteration.</p>
<p>Example:</p>
<pre><code class="hljs language-py">numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]

numbers_iterator = numbers.__iter__()

print(numbers_iterator.__next__()) <span class="hljs-comment"># 1</span>
print(numbers_iterator.__next__()) <span class="hljs-comment"># 2</span>
</code></pre>
<h2>Iterators: internals</h2>
<p>When an iterator is used up a <code>StopIteration</code> exception is raised.</p>
<pre><code class="hljs language-py">print(numbers_iterator.__next__()) <span class="hljs-comment"># 1</span>
print(numbers_iterator.__next__()) <span class="hljs-comment"># 2</span>
print(numbers_iterator.__next__()) <span class="hljs-comment"># 3</span>
print(numbers_iterator.__next__()) <span class="hljs-comment"># StopIteration</span>
</code></pre>
<h2>Iterators: internals</h2>
<p>The global function <code>next()</code> is equivalent to calling <code>.__next__()</code></p>
<pre><code class="hljs language-py">next(numbers_iterator)
</code></pre>
<pre><code class="hljs language-py">numbers_iterator.__next__()
</code></pre>
<h2>Iterators: internals</h2>
<p>exercise: create custom iterables from a class by implementing <code>__iter__</code> and <code>__next__</code></p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> random():
    ...
</code></pre>
<p>or</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">for</span> number <span class="hljs-keyword">in</span> roulette():
    print(number, end=<span class="hljs-string">" "</span>)

<span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">29</span> <span class="hljs-number">7</span> <span class="hljs-number">13</span> <span class="hljs-number">19</span>
</code></pre>
<h1>For ... else</h1>
<h2>for ... else</h2>
<p>A for loop can have an optional else clause</p>
<p>It will be executed if the loop finishes normally - i.e. if Python does not encounter a <code>break</code> or <code>return</code> statement</p>
<h2>for ... else</h2>
<p>This functionality is not present in any other widespread language</p>
<p>Many Python developers don't know it either</p>
<p>Quote from Python's inventor:</p>
<blockquote>
<p>I would not have the feature at all if I had to do it over.</p>
</blockquote>
<h2>Exercises</h2>
<ul>
<li><code>is_prime()</code> with loops and <code>for ... else</code></li>
</ul>
<h1>Functions - advanced</h1>
<h2>Lambdas</h2>
<p>defining a lambda function (anonymous function):</p>
<pre><code class="hljs language-py">multiply = <span class="hljs-keyword">lambda</span> a, b: a * b
</code></pre>
<h2>Lambdas</h2>
<p>using a lambda for sorting:</p>
<pre><code class="hljs language-py">pairs = [(<span class="hljs-number">1</span>, <span class="hljs-string">'one'</span>), (<span class="hljs-number">2</span>, <span class="hljs-string">'two'</span>), (<span class="hljs-number">3</span>, <span class="hljs-string">'three'</span>), (<span class="hljs-number">4</span>, <span class="hljs-string">'four'</span>)]
pairs.sort(key=<span class="hljs-keyword">lambda</span> pair: pair[<span class="hljs-number">1</span>])
</code></pre>
<h2>Decorators</h2>
<p>Decorators: Enable easily modifying a function to add to its behavior</p>
<p>The decorator is a function that takes a function as a parameter and returns a new, modified function</p>
<h2>Decorators</h2>
<pre><code class="hljs language-py"><span class="hljs-meta">@cache</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span><span class="hljs-params">(n)</span>:</span>
    ...
</code></pre>
<p>is equivalent to:</p>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span><span class="hljs-params">(n)</span>:</span>
    ...

fib = cache(fib)
</code></pre>
<h2>Functools</h2>
<h2>Functools - example</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial
open_utf8 = partial(open, encoding=<span class="hljs-string">'UTF-8'</span>)
</code></pre>
<h2>Memoisation</h2>
<p>strategy for performance optimization</p>
<p>return values of previous function calls are cached and used on subsequent function calls with the same arguments</p>
<p>(example: fibonacci)</p>
<h1>Advanced data types</h1>
<h2>Advanced data types</h2>
<ul>
<li>set / frozenset</li>
<li>NamedTuple</li>
<li>enum</li>
</ul>
<h1>set &#x26; frozenset</h1>
<h2>set &#x26; frozenset</h2>
<p>Set: Unordered collection of elements with no duplicates</p>
<p>Frozenset: immutable set</p>
<pre><code class="hljs language-py">ingredients = {<span class="hljs-string">"flour"</span>, <span class="hljs-string">"water"</span>, <span class="hljs-string">"salt"</span>, <span class="hljs-string">"yeast"</span>}
ingredients = set([<span class="hljs-string">"flour"</span>, <span class="hljs-string">"water"</span>, <span class="hljs-string">"salt"</span>, <span class="hljs-string">"yeast"</span>])
ingredients = frozenset([<span class="hljs-string">"flour"</span>, <span class="hljs-string">"water"</span>, <span class="hljs-string">"salt"</span>, <span class="hljs-string">"yeast"</span>])
</code></pre>
<h2>set</h2>
<p>Sets can be an alternative for Lists if the order is not relevant.</p>
<pre><code class="hljs language-py">ingredients1 = {<span class="hljs-string">"flour"</span>, <span class="hljs-string">"water"</span>, <span class="hljs-string">"salt"</span>, <span class="hljs-string">"yeast"</span>}
ingredients2 = {<span class="hljs-string">"water"</span>, <span class="hljs-string">"salt"</span>, <span class="hljs-string">"flour"</span>, <span class="hljs-string">"yeast"</span>}
ingredients1 == ingredients2 <span class="hljs-comment"># True</span>
</code></pre>
<h2>set</h2>
<p>Take care: An empty set must always be created via <code>set()</code></p>
<p>Why does <code>{}</code> not produce an empty set?</p>
<h2>Operations on sets</h2>
<pre><code class="hljs language-py">x = set(<span class="hljs-string">'abc'</span>)
y = set(<span class="hljs-string">'aeiou'</span>)
x | y
x &#x26; y
x - y
x &#x3C;= y
</code></pre>
<h2>Example: Neighboring countries in North America</h2>
<pre><code class="hljs language-py">countries = {
    <span class="hljs-string">"Canada"</span>, <span class="hljs-string">"USA"</span>, <span class="hljs-string">"Mexico"</span>, <span class="hljs-string">"Guatemala"</span>, <span class="hljs-string">"Belize"</span>,
    <span class="hljs-string">"El Salvador"</span>, <span class="hljs-string">"Honduras"</span>, <span class="hljs-string">"Nicaragua"</span>, <span class="hljs-string">"Costa Rica"</span>,
    <span class="hljs-string">"Panama"</span>}

neighbors = [
    {<span class="hljs-string">"Canada"</span>, <span class="hljs-string">"USA"</span>},
    {<span class="hljs-string">"USA"</span>, <span class="hljs-string">"Mexico"</span>},
    {<span class="hljs-string">"Mexico"</span>, <span class="hljs-string">"Guatemala"</span>},
    {<span class="hljs-string">"Mexico"</span>, <span class="hljs-string">"Belize"</span>},
    {<span class="hljs-string">"Guatemala"</span>, <span class="hljs-string">"Belize"</span>},
    {<span class="hljs-string">"Guatemala"</span>, <span class="hljs-string">"El Salvador"</span>},
    {<span class="hljs-string">"Guatemala"</span>, <span class="hljs-string">"Honduras"</span>},
    {<span class="hljs-string">"Honduras"</span>, <span class="hljs-string">"Nicaragua"</span>},
    {<span class="hljs-string">"Nicaragua"</span>, <span class="hljs-string">"Costa Rica"</span>},
    {<span class="hljs-string">"Costa Rica"</span>, <span class="hljs-string">"Panama"</span>}
]
</code></pre>
<h2>Task: Find the "route" from any country to another</h2>
<h1>namedtuple</h1>
<h2>namedtuple</h2>
<p>Example:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple

Point = namedtuple(<span class="hljs-string">'Point'</span>, [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>])

p = Point(<span class="hljs-number">11</span>, y=<span class="hljs-number">22</span>)

print(p[<span class="hljs-number">0</span>])
print(p.x)
</code></pre>
<h1>Enum</h1>
<h2>Enum</h2>
<p>Enum = collection of symbolic names that can be used instead of specific strings</p>
<p>Using a string:</p>
<pre><code class="hljs language-py">a = Button(position=<span class="hljs-string">"left"</span>)
</code></pre>
<p>Using an enum named <em>Position</em>:</p>
<pre><code class="hljs language-py">a = Button(position=Position.LEFT)
</code></pre>
<p>Enums can prevent typos and help with autocompletion.</p>
<h2>Enum</h2>
<p>Defining an enum:</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Position</span><span class="hljs-params">(Enum)</span>:</span>
    UP = <span class="hljs-number">1</span>
    RIGHT = <span class="hljs-number">2</span>
    DOWN = <span class="hljs-number">3</span>
    LEFT = <span class="hljs-number">4</span>
</code></pre>
<h1>Parallelization: threads &#x26; multiprocessing</h1>
<h2>Threads &#x26; multiprocessing - why?</h2>
<p>Threads:</p>
<ul>
<li>dividing resources of a single processor core across various tasks</li>
<li>waiting for I/O</li>
</ul>
<p>Multiprocessing:</p>
<ul>
<li>using multiple processor cores</li>
</ul>
<p>Advantages of threads: simpler, variables may be modified directly</p>
<h2>Threads</h2>
<p>Python will repeatedly switch between parallel threads so they are seemingly running concurrently<br />
However at any point in time only one thread is active (Global interpreter lock - GIL)</p>
<p>Two threads may access the same data</p>
<h2>Starting a new thread</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread

my_thread = Thread(target=<span class="hljs-keyword">print</span>, args=(<span class="hljs-string">'hello'</span>, ), kwargs={end: <span class="hljs-string">""</span>})
my_thread.start()
</code></pre>
<h2>Waiting for a thread to end</h2>
<pre><code class="hljs language-py">my_thread.join()
</code></pre>
<h2>Example: repeated printing</h2>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_multiple</span><span class="hljs-params">(text, n)</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
        print(text, end=<span class="hljs-string">""</span>)

thread_a = Thread(target=print_multiple, args=(<span class="hljs-string">"a"</span>, <span class="hljs-number">20</span>))
thread_b = Thread(target=print_multiple, args=(<span class="hljs-string">"b"</span>, <span class="hljs-number">20</span>))
thread_a.start()
thread_b.start()
thread_a.join()
thread_b.join()
</code></pre>
<h2>Exercise: iterations in a thread</h2>
<p>We'll write a program that executes two threads (a and b)</p>
<p>The two threads contain loops that count how often they were called</p>
<p>example output:</p>
<pre><code class="hljs language-bash">797 iterations <span class="hljs-keyword">in</span> thread a
799 iterations <span class="hljs-keyword">in</span> thread b
1750 iterations <span class="hljs-keyword">in</span> thread a
20254 iterations <span class="hljs-keyword">in</span> thread b
829 iterations <span class="hljs-keyword">in</span> thread a
</code></pre>
<h2>Locks</h2>
<p>Limiting execution to a single thread for some time (e.g. to print multiple things)</p>
<p>Other threads are blocked during this time</p>
<h2>Locks</h2>
<p>In the entire program there should only be one lock object</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Lock

l = Lock()
</code></pre>
<h2>Locks</h2>
<pre><code class="hljs language-py"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">print_multiple_locked</span><span class="hljs-params">(text, n)</span>:</span>
    <span class="hljs-keyword">with</span> l:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(n):
            print(text, end=<span class="hljs-string">""</span>)
</code></pre>
<h2>Threads - Example</h2>
<pre><code class="hljs language-py">threads = []

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000000000000</span>, <span class="hljs-number">1000000000064</span>):
    prime_thread = Thread(target=print_is_prime, args=(i,))
    prime_thread.start()
    threads.append(prime_thread)

<span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:
    thread.join()
print(<span class="hljs-string">'all threads finished'</span>)
</code></pre>
<h2>Threads and xkcd download</h2>
<p>Task: download xkcd comics 100-109 - once in sequence and once in parallel</p>
<h2>Multiprocessing</h2>
<h2>Running functions in separate processes</h2>
<p>Multiprocessing enables running a function inside a separate process</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    p = Process(target=hello)
    p.start()
</code></pre>
<h2>Running functions in separate processes</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    processes = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">30</span>, <span class="hljs-number">40</span>):
        p = Process(target=print_fib, args=(i,))
        processes.append(p)
        p.start()
    <span class="hljs-keyword">for</span> process <span class="hljs-keyword">in</span> processes:
        process.join()
</code></pre>
<h2>Pools</h2>
<p>My be used for concurrent processing of multiple data points which is started concurrently</p>
<p>Example: processing all images inside a folder</p>
<h2>Pools</h2>
<p>Task: compute fibonacci numbers via map() (1 process)</p>
<p>input: <code>[0, 1, 2, 3, 4, 5, 6, ...]</code></p>
<p>return value: <code>[0, 1, 1, 2, 3, 5, 8, ...]</code></p>
<h2>Pools</h2>
<pre><code class="hljs language-py"><span class="hljs-keyword">with</span> Pool(processes=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> pool:
    print(pool.map(fib, range(<span class="hljs-number">1000</span>, <span class="hljs-number">1100</span>)))
</code></pre>
<h2>Data exchange: shared memory</h2>
<p>Integers and floats (and arrays of these types) may be shared across processes</p>
<pre><code class="hljs language-py"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Value, Array, Process

a = Array(<span class="hljs-string">'i'</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">13</span>])
p = Process(target=f, args=(a,))
p.start()
...
</code></pre>
<h2>Other possibilities: Pipes &#x26; Queues</h2>
<p><em>Pipe</em>: Messaging between processes in two directions - e.g. 1 background process which receives tasks from time to time and idles in the meantime</p>
<p><em>Queue</em>: Messaging in one direction from various producers to various consumers (slower than pipes)</p>